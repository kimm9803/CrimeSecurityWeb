<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Shop">

	<!-- 전체 호신용품 리스트 -->
	<select id="allPdList" resultType="com.spring.shop.vo.ProductVo">
		SELECT pdNum, pdName, cateCode, pdPrice, pdStock, pdDes, pdImg, pdDate, pdThumbImg
		FROM products
		ORDER BY pdNum DESC
	</select>
	
	<!-- 카테고리별 호신용품 리스트 -->
	<select id="catePdList" resultType="com.spring.shop.vo.ProductVo">
		SELECT p.pdNum, p.pdName, p.cateCode, p.pdPrice, p.pdStock, p.pdDes, p.pdImg, p.pdDate, p.pdThumbImg
		FROM products p
		INNER JOIN products_category c ON p.cateCode = c.cateCode
		WHERE p.cateCode = #{cateCode}
		ORDER BY p.pdNum DESC
	</select>
	
	<!-- 상품 상세조회 -->
	<select id="getView" resultType="com.spring.shop.vo.ProductVo">
		SELECT pdNum, pdName, cateCode, pdPrice, pdStock, pdDes, pdImg, pdDate, pdThumbImg 
		FROM products
		WHERE pdNum = #{pdNum}
	</select>
	
	<!-- 장바구니 담기 -->
	<insert id="addCart">
		INSERT INTO cart(cartNum, memberid, pdNum, cartStock)
		VALUES (cart_seq.nextVal, #{memberid}, #{pdNum}, #{cartStock})
	</insert>
	
	<!-- 장바구니 리스트 -->
	<select id="getCartList" resultType="com.spring.shop.vo.CartVo">
		SELECT c.cartNum, c.memberid, c.pdNum, c.cartStock, c.addDate, p.pdPrice * c.cartStock AS totalPrice,
			   p.pdName, p.pdPrice, p.pdDate, p.pdThumbImg
		FROM cart c
		INNER JOIN products p ON c.pdNum = p.pdNum
		WHERE c.memberid = #{memberid}
		ORDER BY c.cartNum DESC
	</select>
	
	<!-- 장바구니 삭제 -->
	<delete id="deleteCart" parameterType="hashMap">
		DELETE FROM cart
		WHERE memberid = #{memberid} AND cartNum = #{cartNum}
	</delete>
	
	<!-- 장바구니 결제가격 계산 -->
	<select id="calcPayment" parameterType="hashMap" resultType="int">
		SELECT p.pdPrice * c.cartStock
		FROM cart c
		INNER JOIN products p ON c.pdNum = p.pdNum
		WHERE c.memberid = #{memberid} AND c.cartNum = #{cartNum}
	</select>
	
	<!-- 장바구니 전체 결제가격 계산 -->
	<select id="calcTotalPayment" resultType="int">
		SELECT SUM(p.pdPrice * c.cartStock)
		FROM cart c
		INNER JOIN products p ON c.pdNum = p.pdNum
		WHERE c.memberid = #{memberid}
	</select>
	
	<!-- (장바구니) 단일 상품 구매시 물품 및 가격 정보 -->
	<select id="getCartOne" parameterType="hashMap" resultType="com.spring.shop.vo.CartVo">
		SELECT c.cartNum, c.memberid, c.pdNum, c.cartStock, p.pdName, p.pdPrice, p.pdThumbImg, p.pdPrice * c.cartStock AS totalPrice
		FROM cart c
		INNER JOIN products p ON c.pdNum = p.pdNum
		WHERE c.memberid = #{memberid} AND c.cartNum = #{cartNum}
	</select>
</mapper>